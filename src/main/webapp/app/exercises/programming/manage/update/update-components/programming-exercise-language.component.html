<div class="form-group">
    <label class="label-narrow" jhiTranslate="artemisApp.programmingExercise.programmingLanguage" for="field_programmingLanguage">Programming Language</label>
    <select
        #select
        required
        class="form-select"
        [ngModel]="programmingExerciseUpdateService.config.selectedProgrammingLanguage"
        (ngModelChange)="select.value = programmingExerciseUpdateService.config.onProgrammingLanguageChange($event)"
        name="programmingLanguage"
        id="field_programmingLanguage"
        [disabled]="programmingExerciseUpdateService.config.isImport || !!programmingExerciseUpdateService.config.programmingExercise.id"
    >
        <option *ngFor="let supportedLanguage of programmingExerciseUpdateService.config.supportedLanguages" [value]="supportedLanguage">
            {{ supportedLanguage.charAt(0).toUpperCase() + supportedLanguage.slice(1).toLowerCase() }}
        </option>
    </select>
</div>

<div
    class="form-group mt-2"
    *ngIf="
        programmingExerciseUpdateService.config.programmingExercise.programmingLanguage &&
        programmingExerciseUpdateService.config.projectTypes &&
        programmingExerciseUpdateService.config.projectTypes.length > 0
    "
>
    <label class="label-narrow" jhiTranslate="artemisApp.programmingExercise.projectType" for="field_projectType">Project Type</label>
    <jhi-mode-picker
        required
        [options]="programmingExerciseUpdateService.config.modePickerOptions"
        [value]="programmingExerciseUpdateService.config.selectedProjectType"
        (valueChange)="programmingExerciseUpdateService.config.onProjectTypeChange($event!)"
        [disabled]="programmingExerciseUpdateService.config.isImport || !!programmingExerciseUpdateService.config.programmingExercise.id"
        name="projectType"
        id="field_projectType"
    ></jhi-mode-picker>
    <div
        class="form-check mt-2"
        *ngIf="
            !programmingExerciseUpdateService.config.isImport &&
            !programmingExerciseUpdateService.config.programmingExercise.id &&
            programmingExerciseUpdateService.config.programmingExercise.programmingLanguage === ProgrammingLanguage.JAVA
        "
    >
        <input
            class="form-check-input"
            type="checkbox"
            name="withDependencies"
            id="field_with_dependencies"
            [(ngModel)]="programmingExerciseUpdateService.config.withDependencies"
            (ngModelChange)="programmingExerciseUpdateService.config.onWithDependenciesChanged($event)"
            checked
        />
        <span jhiTranslate="artemisApp.programmingExercise.withDependencies">With Dependencies</span>
        <jhi-help-icon placement="auto" text="artemisApp.programmingExercise.withDependenciesTooltip"></jhi-help-icon>
    </div>
</div>

<div
    class="form-group"
    *ngIf="
        programmingExerciseUpdateService.config.programmingExercise.programmingLanguage &&
        programmingExerciseUpdateService.config.packageNameRequired &&
        programmingExerciseUpdateService.config.programmingExercise.projectType !== ProjectType.XCODE
    "
>
    <label class="label-narrow" jhiTranslate="artemisApp.programmingExercise.packageName" for="field_packageName">Package Name</label>
    <input
        required
        type="text"
        [pattern]="programmingExerciseUpdateService.config.packageNamePattern"
        class="form-control"
        name="packageName"
        id="field_packageName"
        [(ngModel)]="programmingExerciseUpdateService.config.programmingExercise.packageName"
        [readonly]="programmingExerciseUpdateService.config.programmingExercise.id"
        #packageName="ngModel"
        [disabled]="programmingExerciseUpdateService.config.isImport || !!programmingExerciseUpdateService.config.programmingExercise.id"
    />
    <ng-container *ngFor="let e of packageName.errors! | keyvalue | removekeys : ['required']">
        <div *ngIf="packageName.invalid && (packageName.dirty || packageName.touched)" class="alert alert-danger">
            <div
                [jhiTranslate]="'artemisApp.exercise.form.packageName' + '.' + e.key + '.' + programmingExerciseUpdateService.config.programmingExercise.programmingLanguage"
            ></div>
        </div>
    </ng-container>
</div>

<div
    class="form-group"
    *ngIf="
        programmingExerciseUpdateService.config.programmingExercise.programmingLanguage === ProgrammingLanguage.SWIFT &&
        programmingExerciseUpdateService.config.programmingExercise.projectType === ProjectType.XCODE
    "
>
    <label class="label-narrow" jhiTranslate="artemisApp.programmingExercise.appName" for="field_packageName">App Name</label>
    <input
        required
        type="text"
        [pattern]="programmingExerciseUpdateService.config.appNamePatternForSwift"
        class="form-control"
        name="packageName"
        id="field_appName"
        [(ngModel)]="programmingExerciseUpdateService.config.programmingExercise.packageName"
        [readonly]="programmingExerciseUpdateService.config.programmingExercise.id"
        #packageName="ngModel"
        [disabled]="programmingExerciseUpdateService.config.isImport || !!programmingExerciseUpdateService.config.programmingExercise.id"
    />
    <ng-container *ngFor="let e of packageName.errors! | keyvalue | removekeys : ['required']">
        <div *ngIf="packageName.invalid && (packageName.dirty || packageName.touched)" class="alert alert-danger">
            <div
                [jhiTranslate]="'artemisApp.exercise.form.packageName' + '.' + e.key + '.' + programmingExerciseUpdateService.config.programmingExercise.programmingLanguage"
            ></div>
        </div>
    </ng-container>
</div>

<div class="form-group">
    <div *ngIf="programmingExerciseUpdateService.config.programmingExercise.programmingLanguage && programmingExerciseUpdateService.config.staticCodeAnalysisAllowed">
        <div class="form-check custom-control custom-checkbox">
            <input
                type="checkbox"
                class="form-check-input custom-control-input"
                id="field_staticCodeAnalysisEnabled"
                name="staticCodeAnalysisEnabled"
                [disabled]="
                    !!programmingExerciseUpdateService.config.programmingExercise.sequentialTestRuns ||
                    (!programmingExerciseUpdateService.config.isImport && !!programmingExerciseUpdateService.config.programmingExercise.id)
                "
                [(ngModel)]="programmingExerciseUpdateService.config.programmingExercise.staticCodeAnalysisEnabled"
                (change)="programmingExerciseUpdateService.config.onStaticCodeAnalysisChanged()"
            />
            <label class="form-check-label custom-control-label" for="field_staticCodeAnalysisEnabled" jhiTranslate="artemisApp.programmingExercise.enableStaticCodeAnalysis.title">
                Enable Static Code Analysis</label
            >
            <fa-icon
                [icon]="faQuestionCircle"
                class="text-secondary"
                placement="auto"
                ngbTooltip="{{ 'artemisApp.programmingExercise.enableStaticCodeAnalysis.description' | artemisTranslate }}"
            ></fa-icon>
        </div>
        <ng-container *ngIf="programmingExerciseUpdateService.config.programmingExercise.staticCodeAnalysisEnabled">
            <label class="label-narrow" jhiTranslate="artemisApp.programmingExercise.maxStaticCodeAnalysisPenalty.title" for="field_maxPenalty"
                >Max Static Code Analysis Penalty</label
            >
            <fa-icon
                [icon]="faQuestionCircle"
                class="text-secondary"
                placement="auto"
                ngbTooltip="{{ 'artemisApp.programmingExercise.maxStaticCodeAnalysisPenalty.description' | artemisTranslate }}"
            ></fa-icon>
            <div class="input-group">
                <div class="input-group-prepend">
                    <span class="input-group-text">%</span>
                </div>
                <input
                    type="number"
                    [pattern]="programmingExerciseUpdateService.config.maxPenaltyPattern"
                    class="form-control"
                    name="maxPenalty"
                    id="field_maxPenalty"
                    [(ngModel)]="programmingExerciseUpdateService.config.programmingExercise.maxStaticCodeAnalysisPenalty"
                    #maxPenalty="ngModel"
                />
            </div>
            <ng-container *ngFor="let e of maxPenalty.errors! | keyvalue">
                <div *ngIf="maxPenalty.invalid && (maxPenalty.dirty || maxPenalty.touched)" class="alert alert-danger">
                    <div [jhiTranslate]="'artemisApp.exercise.form.maxPenalty' + '.' + e.key"></div>
                </div>
            </ng-container>
        </ng-container>
    </div>

    <!-- It would be very complicated to change the sequential test run feature after an exercise is created, which is why it can only be activated if the exercise was not yet created.-->
    <div *ngIf="sequentialTestRunsAllowed">
        <div class="form-check">
            <label class="form-check-label" for="field_sequentialTestRuns">
                <input
                    class="form-check-input"
                    type="checkbox"
                    name="sequentialTestRuns"
                    id="field_sequentialTestRuns"
                    [disabled]="
                        !!programmingExerciseUpdateService.config.programmingExercise.id ||
                        !!programmingExerciseUpdateService.config.programmingExercise.staticCodeAnalysisEnabled ||
                        !!programmingExerciseUpdateService.config.programmingExercise.testwiseCoverageEnabled
                    "
                    [(ngModel)]="programmingExerciseUpdateService.config.programmingExercise.sequentialTestRuns"
                    checked
                />
                <span jhiTranslate="artemisApp.programmingExercise.sequentialTestRuns.title">Differentiate Test Case Execution</span>
                <jhi-help-icon placement="auto" text="artemisApp.programmingExercise.sequentialTestRuns.description"></jhi-help-icon>
            </label>
        </div>
    </div>

    <div
        *ngIf="
            programmingExerciseUpdateService.config.programmingExercise.programmingLanguage === ProgrammingLanguage.JAVA ||
            programmingExerciseUpdateService.config.programmingExercise.programmingLanguage === ProgrammingLanguage.KOTLIN
        "
    >
        <div class="form-check">
            <label class="form-check-label" for="field_testwiseCoverageEnabled">
                <input
                    class="form-check-input"
                    type="checkbox"
                    name="testwiseCoverageEnabled"
                    id="field_testwiseCoverageEnabled"
                    [disabled]="
                        !!programmingExerciseUpdateService.config.programmingExercise.sequentialTestRuns || !!programmingExerciseUpdateService.config.programmingExercise.id
                    "
                    [(ngModel)]="programmingExerciseUpdateService.config.programmingExercise.testwiseCoverageEnabled"
                    checked
                />
                <span jhiTranslate="artemisApp.programmingExercise.recordTestwiseCoverage">Record Testwise Coverage</span>
                <fa-icon
                    [icon]="faQuestionCircle"
                    class="text-secondary"
                    placement="auto"
                    ngbTooltip="{{ 'artemisApp.programmingExercise.recordTestwiseCoverageTooltip' | artemisTranslate }}"
                ></fa-icon>
            </label>
        </div>
    </div>
</div>
