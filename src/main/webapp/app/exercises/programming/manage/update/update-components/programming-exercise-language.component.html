<div class="form-group">
    <label class="label-narrow" jhiTranslate="artemisApp.programmingExercise.programmingLanguage" for="field_programmingLanguage">Programming Language</label>
    <select
        #select
        required
        class="form-select"
        [ngModel]="programmingExerciseUpdateService.stepInputs.selectedProgrammingLanguage"
        (ngModelChange)="select.value = programmingExerciseUpdateService.stepInputs.onProgrammingLanguageChange($event)"
        name="programmingLanguage"
        id="field_programmingLanguage"
        [disabled]="programmingExerciseUpdateService.stepInputs.isImport || !!programmingExerciseUpdateService.stepInputs.programmingExercise.id"
    >
        <option *ngFor="let supportedLanguage of programmingExerciseUpdateService.stepInputs.supportedLanguages" [value]="supportedLanguage">
            {{ supportedLanguage.charAt(0).toUpperCase() + supportedLanguage.slice(1).toLowerCase() }}
        </option>
    </select>
</div>

<div
    class="form-group mt-2"
    *ngIf="
        programmingExerciseUpdateService.stepInputs.programmingExercise.programmingLanguage &&
        programmingExerciseUpdateService.stepInputs.projectTypes &&
        programmingExerciseUpdateService.stepInputs.projectTypes.length > 0
    "
>
    <label class="label-narrow" jhiTranslate="artemisApp.programmingExercise.projectType" for="field_projectType">Project Type</label>
    <jhi-mode-picker
        required
        [options]="programmingExerciseUpdateService.stepInputs.modePickerOptions"
        [value]="programmingExerciseUpdateService.stepInputs.selectedProjectType"
        (valueChange)="programmingExerciseUpdateService.stepInputs.onProjectTypeChange($event!)"
        [disabled]="programmingExerciseUpdateService.stepInputs.isImport || !!programmingExerciseUpdateService.stepInputs.programmingExercise.id"
        name="projectType"
        id="field_projectType"
    ></jhi-mode-picker>
    <div
        class="form-check mt-2"
        *ngIf="
            !programmingExerciseUpdateService.stepInputs.isImport &&
            !programmingExerciseUpdateService.stepInputs.programmingExercise.id &&
            programmingExerciseUpdateService.stepInputs.programmingExercise.programmingLanguage === ProgrammingLanguage.JAVA
        "
    >
        <input
            class="form-check-input"
            type="checkbox"
            name="withDependencies"
            id="field_with_dependencies"
            [(ngModel)]="programmingExerciseUpdateService.stepInputs.withDependencies"
            (ngModelChange)="programmingExerciseUpdateService.stepInputs.onWithDependenciesChanged($event)"
            checked
        />
        <span jhiTranslate="artemisApp.programmingExercise.withDependencies">With Dependencies</span>
        <jhi-help-icon placement="auto" text="artemisApp.programmingExercise.withDependenciesTooltip"></jhi-help-icon>
    </div>
</div>

<div
    class="form-group"
    *ngIf="
        programmingExerciseUpdateService.stepInputs.programmingExercise.programmingLanguage &&
        programmingExerciseUpdateService.stepInputs.packageNameRequired &&
        programmingExerciseUpdateService.stepInputs.programmingExercise.projectType !== ProjectType.XCODE
    "
>
    <label class="label-narrow" jhiTranslate="artemisApp.programmingExercise.packageName" for="field_packageName">Package Name</label>
    <input
        required
        type="text"
        [pattern]="programmingExerciseUpdateService.stepInputs.packageNamePattern"
        class="form-control"
        name="packageName"
        id="field_packageName"
        [(ngModel)]="programmingExerciseUpdateService.stepInputs.programmingExercise.packageName"
        [readonly]="programmingExerciseUpdateService.stepInputs.programmingExercise.id"
        #packageName="ngModel"
        [disabled]="programmingExerciseUpdateService.stepInputs.isImport || !!programmingExerciseUpdateService.stepInputs.programmingExercise.id"
    />
    <ng-container *ngFor="let e of packageName.errors! | keyvalue | removekeys : ['required']">
        <div *ngIf="packageName.invalid && (packageName.dirty || packageName.touched)" class="alert alert-danger">
            <div
                [jhiTranslate]="'artemisApp.exercise.form.packageName' + '.' + e.key + '.' + programmingExerciseUpdateService.stepInputs.programmingExercise.programmingLanguage"
            ></div>
        </div>
    </ng-container>
</div>

<div
    class="form-group"
    *ngIf="
        programmingExerciseUpdateService.stepInputs.programmingExercise.programmingLanguage === ProgrammingLanguage.SWIFT &&
        programmingExerciseUpdateService.stepInputs.programmingExercise.projectType === ProjectType.XCODE
    "
>
    <label class="label-narrow" jhiTranslate="artemisApp.programmingExercise.appName" for="field_packageName">App Name</label>
    <input
        required
        type="text"
        [pattern]="programmingExerciseUpdateService.stepInputs.appNamePatternForSwift"
        class="form-control"
        name="packageName"
        id="field_appName"
        [(ngModel)]="programmingExerciseUpdateService.stepInputs.programmingExercise.packageName"
        [readonly]="programmingExerciseUpdateService.stepInputs.programmingExercise.id"
        #packageName="ngModel"
        [disabled]="programmingExerciseUpdateService.stepInputs.isImport || !!programmingExerciseUpdateService.stepInputs.programmingExercise.id"
    />
    <ng-container *ngFor="let e of packageName.errors! | keyvalue | removekeys : ['required']">
        <div *ngIf="packageName.invalid && (packageName.dirty || packageName.touched)" class="alert alert-danger">
            <div
                [jhiTranslate]="'artemisApp.exercise.form.packageName' + '.' + e.key + '.' + programmingExerciseUpdateService.stepInputs.programmingExercise.programmingLanguage"
            ></div>
        </div>
    </ng-container>
</div>

<div
    class="form-group mt-2"
    *ngIf="programmingExerciseUpdateService.stepInputs.programmingExercise.programmingLanguage && programmingExerciseUpdateService.stepInputs.staticCodeAnalysisAllowed"
>
    <div class="form-check custom-control custom-checkbox">
        <input
            type="checkbox"
            class="form-check-input custom-control-input"
            id="field_staticCodeAnalysisEnabled"
            name="staticCodeAnalysisEnabled"
            [disabled]="
                !!programmingExerciseUpdateService.stepInputs.programmingExercise.sequentialTestRuns ||
                (!programmingExerciseUpdateService.stepInputs.isImport && !!programmingExerciseUpdateService.stepInputs.programmingExercise.id)
            "
            [(ngModel)]="programmingExerciseUpdateService.stepInputs.programmingExercise.staticCodeAnalysisEnabled"
            (change)="programmingExerciseUpdateService.stepInputs.onStaticCodeAnalysisChanged()"
        />
        <label class="form-check-label custom-control-label" for="field_staticCodeAnalysisEnabled" jhiTranslate="artemisApp.programmingExercise.enableStaticCodeAnalysis.title">
            Enable Static Code Analysis</label
        >
        <fa-icon
            [icon]="faQuestionCircle"
            class="text-secondary"
            placement="auto"
            ngbTooltip="{{ 'artemisApp.programmingExercise.enableStaticCodeAnalysis.description' | artemisTranslate }}"
        ></fa-icon>
    </div>
    <ng-container *ngIf="programmingExerciseUpdateService.stepInputs.programmingExercise.staticCodeAnalysisEnabled">
        <label class="label-narrow" jhiTranslate="artemisApp.programmingExercise.maxStaticCodeAnalysisPenalty.title" for="field_maxPenalty">Max Static Code Analysis Penalty</label>
        <fa-icon
            [icon]="faQuestionCircle"
            class="text-secondary"
            placement="auto"
            ngbTooltip="{{ 'artemisApp.programmingExercise.maxStaticCodeAnalysisPenalty.description' | artemisTranslate }}"
        ></fa-icon>
        <div class="input-group">
            <div class="input-group-prepend">
                <span class="input-group-text">%</span>
            </div>
            <input
                type="number"
                [pattern]="programmingExerciseUpdateService.stepInputs.maxPenaltyPattern"
                class="form-control"
                name="maxPenalty"
                id="field_maxPenalty"
                [(ngModel)]="programmingExerciseUpdateService.stepInputs.programmingExercise.maxStaticCodeAnalysisPenalty"
                #maxPenalty="ngModel"
            />
        </div>
        <ng-container *ngFor="let e of maxPenalty.errors! | keyvalue">
            <div *ngIf="maxPenalty.invalid && (maxPenalty.dirty || maxPenalty.touched)" class="alert alert-danger">
                <div [jhiTranslate]="'artemisApp.exercise.form.maxPenalty' + '.' + e.key"></div>
            </div>
        </ng-container>
    </ng-container>
</div>

<!-- It would be very complicated to change the sequential test run feature after an exercise is created, which is why it can only be activated if the exercise was not yet created.-->
<div class="form-group mb-0" *ngIf="sequentialTestRunsAllowed">
    <div class="form-check">
        <label class="form-check-label" for="field_sequentialTestRuns">
            <input
                class="form-check-input"
                type="checkbox"
                name="sequentialTestRuns"
                id="field_sequentialTestRuns"
                [disabled]="
                    !!programmingExerciseUpdateService.stepInputs.programmingExercise.id ||
                    !!programmingExerciseUpdateService.stepInputs.programmingExercise.staticCodeAnalysisEnabled ||
                    !!programmingExerciseUpdateService.stepInputs.programmingExercise.testwiseCoverageEnabled
                "
                [(ngModel)]="programmingExerciseUpdateService.stepInputs.programmingExercise.sequentialTestRuns"
                checked
            />
            <span jhiTranslate="artemisApp.programmingExercise.sequentialTestRuns.title">Differentiate Test Case Execution</span>
            <jhi-help-icon placement="auto" text="artemisApp.programmingExercise.sequentialTestRuns.description"></jhi-help-icon>
        </label>
    </div>
</div>

<div
    class="form-group mb-0"
    *ngIf="
        programmingExerciseUpdateService.stepInputs.programmingExercise.programmingLanguage === ProgrammingLanguage.JAVA ||
        programmingExerciseUpdateService.stepInputs.programmingExercise.programmingLanguage === ProgrammingLanguage.KOTLIN
    "
>
    <div class="form-check">
        <label class="form-check-label" for="field_testwiseCoverageEnabled">
            <input
                class="form-check-input"
                type="checkbox"
                name="testwiseCoverageEnabled"
                id="field_testwiseCoverageEnabled"
                [disabled]="
                    !!programmingExerciseUpdateService.stepInputs.programmingExercise.sequentialTestRuns || !!programmingExerciseUpdateService.stepInputs.programmingExercise.id
                "
                [(ngModel)]="programmingExerciseUpdateService.stepInputs.programmingExercise.testwiseCoverageEnabled"
                checked
            />
            <span jhiTranslate="artemisApp.programmingExercise.recordTestwiseCoverage">Record Testwise Coverage</span>
            <fa-icon
                [icon]="faQuestionCircle"
                class="text-secondary"
                placement="auto"
                ngbTooltip="{{ 'artemisApp.programmingExercise.recordTestwiseCoverageTooltip' | artemisTranslate }}"
            ></fa-icon>
        </label>
    </div>
</div>
